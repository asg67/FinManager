# User Spec: FinManager (SMART)

## Specific (Конкретно)

**FinManager** — веб-приложение для управления финансами бизнеса. Заменяет 4 Telegram-бота (3 PDF-бота + 1 ДДС-бот), объединяя всё в единый интерфейс.

### Модуль 1: Аутентификация и профиль
- Регистрация по email + пароль
- Логин с JWT-токенами
- Профиль пользователя: имя, email, язык (ru/en), тема (dark/light)
- Два типа пользователей:
  - **Владелец** — регистрируется сам, полный доступ
  - **Сотрудник** — приглашается владельцем, гранулярные права

### Модуль 2: Настройка бизнес-сущностей (Settings)
Владелец настраивает свой бизнес через UI:

**ИП (юридические лица):**
- Создание/редактирование/удаление ИП
- Название (например: "ИП Скобелев")

**Счета и карты (привязаны к ИП):**
- Тип: расчётный счёт / карта / наличные / депозит
- Банк: Сбер / Т-Банк / Модуль / другой
- Название (например: "р/с Тинькофф ИП Скобелев")
- Номер счёта/договора (для валидации PDF)

**Типы затрат (категории расходов):**
- Предустановленные: Закупка товаров, Накладные, Маркетинг, Административные
- Можно добавлять свои
- Каждый тип содержит статьи (вложенный уровень)

**Статьи затрат (привязаны к типу):**
- Например: Маркетинг → Фотосессия, Кэшбек, Самовыкупы, Блогеры...
- Редактируемые: добавить/удалить/переименовать

**Шаблоны ДДС:**
- Пользователь создаёт шаблон с предзаполненными полями
- Пример: "Закупка Алексеев Тиньк" = ИП Алексеев + Расход + Карта Тиньк + Закупка товаров
- При использовании: заполнить только сумму + номер заказа + комментарий

### Модуль 3: Управление сотрудниками
- Владелец приглашает сотрудника (по email)
- Назначение прав (чекбоксы):
  - [ ] ДДС — ввод операций
  - [ ] PDF — загрузка выписок
  - [ ] Аналитика — просмотр дашборда и графиков
  - [ ] Экспорт — выгрузка данных
- Привязка сотрудника к конкретным ИП (видит только свои)
- Редактирование и отзыв прав
- Удаление сотрудника

### Модуль 4: ДДС (движение денежных средств)
Ручной ввод финансовых операций через модальный wizard:

**Типы операций:**
- **Приход** → выбор счёта "куда" → сумма → комментарий
- **Расход** → выбор счёта "откуда" → тип затрат → статья/номер заказа → сумма → комментарий
- **Перемещение** → "откуда" → "куда" → сумма → комментарий

**Правила перемещений:**
- Внутри ИП: любой счёт → любой другой
- Между ИП: только наличные → наличные

**Быстрый ввод через шаблоны:**
- Выбрал шаблон → заполнил оставшиеся поля → подтвердил

**Превью перед сохранением:**
- Сводка всех введённых данных (как в боте)
- Кнопки: "Подтвердить" / "Изменить"

**Таблица операций:**
- Полный список ДДС-операций с фильтрами
- Фильтры: по ИП, по счёту, по типу операции, по дате, по сумме
- Поиск по комментарию/номеру заказа
- Редактирование/удаление записей
- Цветовая индикация: зелёный = приход, красный = расход, синий = перемещение

### Модуль 5: PDF-загрузка банковских выписок
Загрузка и парсинг PDF-выписок:

**Flow:**
1. Выбрать ИП и счёт/карту
2. Drag & drop PDF (или кнопка "Выбрать файл")
3. Отправка на Python-микросервис (FastAPI + pdfplumber)
4. Получение распарсенных данных
5. **Превью-таблица**: пользователь проверяет данные
   - Может удалить строки
   - Может исправить значения
   - Видит дубликаты (подсвечены)
6. Кнопка "Подтвердить и сохранить"
7. Дедупликация при записи в БД

**Поддерживаемые банки:**
- Сбер (карта)
- Т-Банк (карта)
- Т-Банк (депозит)
- (расширяемо — добавление новых парсеров)

**Данные из PDF:**
- Месяц, Дата, Время, Счёт, Сумма, Приход/Расход
- Контрагент, Назначение, Остаток средств, Статья ДДС

### Модуль 6: Dashboard (главный экран)
Сводная панель при входе:

**Summary cards (верх):**
- Общий баланс по всем счетам
- Приход за текущий месяц
- Расход за текущий месяц
- Количество операций

**Виджеты карт/счетов:**
- Визуальное представление каждого счёта/карты
- Остаток, последнее обновление

**Графики:**
- Line chart: таймлайн баланса (фильтр: 7D / 30D / 90D / год)
- Bar chart: расходы по категориям за месяц
- Pie chart: распределение расходов

**Последние операции:**
- Список из 10-20 последних записей (ДДС + PDF)
- Быстрые действия: редактировать, удалить

**Быстрые действия:**
- Кнопка "Добавить операцию" → модалка ДДС
- Кнопка "Загрузить PDF"

### Модуль 7: Уведомления
- Колокольчик в хедере с бейджем
- Напоминания о загрузке выписок:
  - 2 числа — выписки за прошлый месяц
  - 12 числа — выписки за 1–10 текущего
  - 22 числа — выписки за 10–20 текущего
- Уведомления о действиях сотрудников (новая операция, загруженный PDF)
- Страница "Все уведомления" с историей

### Модуль 8: Экспорт
- Экспорт транзакций в CSV
- Экспорт в PDF-отчёт (в будущем)
- Фильтры при экспорте: период, ИП, счёт, тип операции

### Модуль 9: Интернационализация (i18n)
- Русский язык (по умолчанию)
- Английский язык
- Переключатель в настройках профиля
- Все тексты интерфейса, ошибки, уведомления — переводимые

### Модуль 10: Тёмная / Светлая тема
- Toggle в хедере или настройках
- Glassmorphism стиль в обеих темах
- Сохранение выбора в профиле

---

## Measurable (Измеримо)

### Функциональные метрики
- Ввод ДДС-операции через шаблон: < 15 секунд (3-4 клика)
- Ввод ДДС-операции без шаблона: < 45 секунд
- Загрузка + парсинг PDF: < 10 секунд для файла до 5MB
- Dashboard загрузка: < 2 секунды
- Поддержка: минимум 3 банка для PDF-парсинга

### Технические метрики
- API response time: < 200ms (CRUD операции)
- Test coverage: > 80%
- Lighthouse score: > 90 (Performance, Accessibility)
- Адаптив: корректное отображение от 320px до 2560px

---

## Achievable (Достижимо)

### Архитектура
- Frontend: React 19 + TypeScript + Vite + Tailwind CSS
- Backend: Node.js + Express + TypeScript + Prisma ORM
- БД: PostgreSQL 16 (Docker)
- PDF: Python-микросервис (FastAPI + pdfplumber)
- Auth: JWT
- i18n: react-i18next

### Ресурсы
- Разработка: пользователь + Claude
- Инфраструктура: локальная разработка (Docker)
- Деплой: определяется позже

---

## Relevant (Релевантно)

### Проблемы, которые решаем
1. **3 отдельных бота** → один интерфейс для всех ИП
2. **Линейный flow бота** → шаблоны для мгновенного ввода
3. **Google Sheets как БД** → PostgreSQL (скорость, надёжность, SQL-запросы)
4. **Хардкод конфигов** → настраиваемые справочники через UI
5. **Нет визуализации** → dashboard с графиками
6. **Нет превью PDF** → таблица для проверки перед сохранением
7. **Хардкод user_id для прав** → нормальная система ролей

### Кому нужно
- Владельцы ИП: видят полную картину финансов
- Сотрудники: вносят данные (ДДС, PDF) в рамках своих прав
- Бухгалтерия: экспорт данных для отчётности

---

## Time-bound (Сроки по фазам)

### Фаза 1: Фундамент
- Auth (регистрация/логин/JWT)
- Настройка сущностей (ИП, счета, категории, статьи)
- Базовая навигация и layout (sidebar, header, theme toggle)
- i18n каркас

### Фаза 2: ДДС
- Модальный wizard (приход/расход/перемещение)
- Шаблоны ДДС (CRUD + использование)
- Таблица операций (список, фильтры, поиск)
- Редактирование/удаление операций

### Фаза 3: PDF
- Python-микросервис (FastAPI + pdfplumber)
- Загрузка PDF через веб
- Превью-таблица распарсенных данных
- Сохранение в БД с дедупликацией

### Фаза 4: Dashboard и аналитика
- Summary cards
- Графики (line, bar, pie)
- Виджеты счетов
- Последние операции

### Фаза 5: Сотрудники и уведомления
- Приглашение сотрудников
- Система прав (чекбоксы)
- Уведомления (колокольчик, напоминания)
- Экспорт CSV

### Фаза 6: Polish
- UI polish, анимации
- Mobile adaptive доводка
- Performance оптимизация
- Финальное тестирование
