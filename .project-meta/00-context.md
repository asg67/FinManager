# FinManager — Контекст проекта

## Суть
Веб-приложение для управления финансами бизнеса. Полностью заменяет два Telegram-бота:
1. **PDF-бот** — загрузка банковских выписок (PDF), парсинг, сохранение транзакций
2. **ДДС-бот** — ручной ввод финансовых операций (приход/расход/перемещение)

Google Sheets полностью убираем — всё хранится в PostgreSQL.

## Пользователи и роли

### Владелец карты/счёта (Account Owner)
- Регистрируется самостоятельно (email + пароль)
- В профиле добавляет свои ИП, банковские счета, карты
- Полный доступ ко всем функциям по своим счетам
- Может добавлять сотрудников и выдавать права (галочками):
  - Доступ к ДДС (ввод операций)
  - Доступ к загрузке PDF-выписок
  - Доступ к просмотру аналитики
  - Доступ к экспорту данных

### Сотрудник (Employee)
- Добавляется владельцем (приглашение)
- Видит только то, к чему выдан доступ
- Может загружать PDF и/или вносить ДДС-операции (по правам)

## Основные функции

### 1. PDF-обработка банковских выписок
Источник логики: `ZF_PM_*_PDF.py`

- Загрузка PDF через веб-интерфейс
- Поддерживаемые банки: Сбер, Т-Банк (карта), Т-Банк (депозит)
- Парсинг через pdfplumber:
  - Извлечение: дата, время, сумма, контрагент, назначение, остаток
  - Определение: приход/расход
- Дедупликация (строгая + нестрогая проверка при загрузке)
- Расчёт нарастающего остатка (running balance)
- Колонки: Месяц, Дата, Время, Счёт, Сумма, Приход/Расход, Контрагент, Назначение, Остаток средств, Статья ДДС

### 2. ДДС (движение денежных средств)
Источник логики: `DDS_BOT/pm_dds.py`

- Типы операций:
  - **Приход** — выбрать счёт "куда", сумма, комментарий
  - **Расход** — выбрать счёт "откуда", тип затрат, статья, сумма, комментарий
  - **Перемещение** — "откуда" → "куда", сумма, комментарий

- Типы затрат (расход):
  - Закупка товаров → номер заказа
  - Накладные расходы → статья (Доставка, Комиссия, Упаковка, ЧЗ, ОТК)
  - Маркетинг и реклама → статья (Фотосессия, Кэшбек, Самовыкупы, Блогеры, Образцы, Другое)
  - Административные расходы → статья (Аренда, ЗП оклад, ЗП бонус, Обучение, ПО, Кредит, Бухгалтерия, Логистика, Другое)

- Правила перемещений:
  - Внутри одного ИП: любой счёт → любой другой
  - Между ИП: только наличные → наличные

### 3. Аналитика / Dashboard
- Сводка по счетам (остатки, приходы, расходы)
- Графики по категориям расходов
- Таймлайн операций
- Сравнение периодов

### 4. Управление сущностями (через UI)
- ИП (юр. лица) — добавление, редактирование
- Счета и карты — привязка к ИП
- Категории и статьи затрат — настраиваемые
- Сотрудники — приглашение, управление правами

## Требования к UI/UX
- Адаптивный дизайн (мобильная версия обязательна)
- Тёмная и светлая тема
- Дизайн: Pinterest-референс (будет приложен)
- Быстрый ввод операций (минимум кликов, как в боте)
- Подтверждение перед сохранением (превью данных, как в боте)

## Технический стек
- Frontend: React 19 + TypeScript + Vite + Tailwind CSS
- Backend: Node.js + Express + TypeScript + Prisma
- БД: PostgreSQL 16 (Docker)
- Auth: JWT (email + пароль)
- PDF parsing: pdfplumber (Python-сервис или Node.js аналог)

## Заметка по PDF-парсингу
Текущий парсинг написан на Python (pdfplumber). Варианты:
- Микросервис на Python для парсинга PDF
- Портировать на Node.js (pdf-parse / pdf.js)
Решение зависит от сложности парсинга — банковские PDF требуют точного извлечения таблиц.
